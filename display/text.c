#include "pico/stdlib.h"
#include "hardware/spi.h"
#include "string.h"
#include "stdio.h"
#include "oled.h"
#include "text.h"

const uint8_t font5x7[][5];
const uint8_t hex_array[];

void reverse_string(char *str) {
    int length = strlen(str);
    int half_length = length / 2;
    for (int i = 0; i < half_length; i++) {
        char temp = str[i];
        str[i] = str[length - i - 1];
        str[length - i - 1] = temp;
    }
}

void sh1107_draw_char(uint8_t x, uint8_t y, char c, bool clear) {
    if (c < 32 || c > 126) return; // Only support printable ASCII characters

    int height = 5;
    int width = 7;

    for (uint8_t i = 0; i < height; i++) {
        uint8_t line = font5x7[c - 32][i];
        for (uint8_t j = 0; j < width; j++) {
            if (clear == true) {
                sh1107_set_pixel(x + i, y - j, false);
            } else {
                if (line & 0x01) {
                    sh1107_set_pixel(x + i, y - j, true);
                } else {
                    sh1107_set_pixel(x + i, y - j, false);
                }
            }

            line >>= 1;
        }
    }
}

void sh1107_draw_string(uint8_t x, uint8_t y, char n[]) {
    reverse_string(str);

    while (*str) {
        sh1107_draw_char(x, y, *str, false);
        x += 6; // Move to the next character position (5 pixels + 1 space)
        str++;
    }
}
void sh1107_clear_string(uint8_t x, uint8_t y, const char *str) {
    while (*str) {
        sh1107_draw_char(x, y, *str, true);
        x += 6; // Move to the next character position (5 pixels + 1 space)
        str++;
    }
}

// 5x7 font array for ASCII characters 32-126 flipped vertically
const uint8_t font5x7[][5] = {
    {0x00, 0x00, 0x00, 0x00, 0x00}, // ' ' (space)
    {0x00, 0x00, 0x5F, 0x00, 0x00}, // '!' (exclamation mark)
    {0x00, 0x07, 0x00, 0x07, 0x00}, // '"' (double quote)
    {0x14, 0x7F, 0x14, 0x7F, 0x14}, // '#' (hash)
    {0x12, 0x2A, 0x7F, 0x2A, 0x24}, // '$' (dollar)
    {0x62, 0x64, 0x08, 0x13, 0x23}, // '%' (percent)
    {0x50, 0x22, 0x55, 0x49, 0x36}, // '&' (ampersand)
    {0x00, 0x00, 0x03, 0x05, 0x00}, // ''' (single quote)
    {0x00, 0x41, 0x22, 0x1C, 0x00}, // '(' (left parenthesis)
    {0x00, 0x1C, 0x22, 0x41, 0x00}, // ')' (right parenthesis)
    {0x14, 0x08, 0x3E, 0x08, 0x14}, // '*' (asterisk)
    {0x08, 0x08, 0x3E, 0x08, 0x08}, // '+' (plus)
    {0x00, 0x00, 0x30, 0x50, 0x00}, // ',' (comma)
    {0x08, 0x08, 0x08, 0x08, 0x08}, // '-' (minus)
    {0x00, 0x00, 0x60, 0x60, 0x00}, // '.' (period)
    {0x02, 0x04, 0x08, 0x10, 0x20}, // '/' (slash)
    {0x3E, 0x45, 0x49, 0x51, 0x3E}, // '0' (zero)
    {0x00, 0x40, 0x7F, 0x42, 0x00}, // '1' (one)
    {0x46, 0x49, 0x51, 0x61, 0x42}, // '2' (two)
    {0x31, 0x4B, 0x45, 0x41, 0x21}, // '3' (three)
    {0x10, 0x7F, 0x12, 0x14, 0x18}, // '4' (four)
    {0x39, 0x45, 0x45, 0x45, 0x27}, // '5' (five)
    {0x30, 0x49, 0x49, 0x4A, 0x3C}, // '6' (six)
    {0x03, 0x05, 0x09, 0x71, 0x01}, // '7' (seven)
    {0x36, 0x49, 0x49, 0x49, 0x36}, // '8' (eight)
    {0x1E, 0x29, 0x49, 0x49, 0x06}, // '9' (nine)
    {0x00, 0x00, 0x36, 0x36, 0x00}, // ':' (colon)
    {0x00, 0x00, 0x36, 0x56, 0x00}, // ';' (semicolon)
    {0x00, 0x41, 0x22, 0x14, 0x08}, // '<' (less than)
    {0x14, 0x14, 0x14, 0x14, 0x14}, // '=' (equal)
    {0x08, 0x14, 0x22, 0x41, 0x00}, // '>' (greater than)
    {0x06, 0x09, 0x51, 0x01, 0x02}, // '?' (question mark)
    {0x3E, 0x41, 0x79, 0x49, 0x32}, // '@' (at)
    {0x7E, 0x11, 0x11, 0x11, 0x7E}, // 'A' (A)
    {0x36, 0x49, 0x49, 0x49, 0x7F}, // 'B' (B)
    {0x22, 0x41, 0x41, 0x41, 0x3E}, // 'C' (C)
    {0x1C, 0x22, 0x41, 0x41, 0x7F}, // 'D' (D)
    {0x41, 0x49, 0x49, 0x49, 0x7F}, // 'E' (E)
    {0x01, 0x09, 0x09, 0x09, 0x7F}, // 'F' (F)
    {0x7A, 0x49, 0x49, 0x41, 0x3E}, // 'G' (G)
    {0x7F, 0x08, 0x08, 0x08, 0x7F}, // 'H' (H)
    {0x00, 0x41, 0x7F, 0x41, 0x00}, // 'I' (I)
    {0x01, 0x3F, 0x41, 0x40, 0x20}, // 'J' (J)
    {0x41, 0x22, 0x14, 0x08, 0x7F}, // 'K' (K)
    {0x40, 0x40, 0x40, 0x40, 0x7F}, // 'L' (L)
    {0x7F, 0x04, 0x02, 0x04, 0x7F}, // 'M' (M)
    {0x7F, 0x10, 0x08, 0x04, 0x7F}, // 'N' (N)
    {0x3E, 0x41, 0x41, 0x41, 0x3E}, // 'O' (O)
    {0x06, 0x09, 0x09, 0x09, 0x7F}, // 'P' (P)
    {0x5E, 0x21, 0x51, 0x41, 0x3E}, // 'Q' (Q)
    {0x46, 0x29, 0x19, 0x09, 0x7F}, // 'R' (R)
    {0x31, 0x49, 0x49, 0x49, 0x46}, // 'S' (S)
    {0x01, 0x01, 0x7F, 0x01, 0x01}, // 'T' (T)
    {0x3F, 0x40, 0x40, 0x40, 0x3F}, // 'U' (U)
    {0x1F, 0x20, 0x40, 0x20, 0x1F}, // 'V' (V)
    {0x3F, 0x40, 0x38, 0x40, 0x3F}, // 'W' (W)
    {0x63, 0x14, 0x08, 0x14, 0x63}, // 'X' (X)
    {0x03, 0x04, 0x78, 0x04, 0x03}, // 'Y' (Y)
    {0x43, 0x45, 0x49, 0x51, 0x61}, // 'Z' (Z)
    {0x00, 0x41, 0x41, 0x7F, 0x00}, // '[' (left bracket)
    {0x20, 0x10, 0x08, 0x04, 0x02}, // '\' (backslash)
    {0x00, 0x7F, 0x41, 0x41, 0x00}, // ']' (right bracket)
    {0x04, 0x02, 0x01, 0x02, 0x04}, // '^' (caret)
    {0x80, 0x80, 0x80, 0x80, 0x80}, // '_' (underscore)
    {0x00, 0x04, 0x02, 0x01, 0x00}, // '`' (grave accent)
    {0x78, 0x54, 0x54, 0x54, 0x20}, // 'a' (a)
    {0x38, 0x44, 0x44, 0x48, 0x7F}, // 'b' (b)
    {0x20, 0x44, 0x44, 0x44, 0x38}, // 'c' (c)
    {0x7F, 0x48, 0x44, 0x44, 0x38}, // 'd' (d)
    {0x18, 0x54, 0x54, 0x54, 0x38}, // 'e' (e)
    {0x02, 0x01, 0x09, 0x7E, 0x08}, // 'f' (f)
    {0x3E, 0x52, 0x52, 0x52, 0x0C}, // 'g' (g)
    {0x78, 0x04, 0x04, 0x08, 0x7F}, // 'h' (h)
    {0x00, 0x40, 0x7D, 0x44, 0x00}, // 'i' (i)
    {0x00, 0x3D, 0x44, 0x40, 0x20}, // 'j' (j)
    {0x00, 0x44, 0x28, 0x10, 0x7F}, // 'k' (k)
    {0x00, 0x40, 0x7F, 0x41, 0x00}, // 'l' (l)
    {0x78, 0x04, 0x18, 0x04, 0x7C}, // 'm' (m)
    {0x78, 0x04, 0x04, 0x08, 0x7C}, // 'n' (n)
    {0x38, 0x44, 0x44, 0x44, 0x38}, // 'o' (o)
    {0x08, 0x14, 0x14, 0x14, 0x7C}, // 'p' (p)
    {0x7C, 0x14, 0x14, 0x14, 0x08}, // 'q' (q)
    {0x08, 0x04, 0x04, 0x08, 0x7C}, // 'r' (r)
    {0x20, 0x54, 0x54, 0x54, 0x48}, // 's' (s)
    {0x20, 0x40, 0x44, 0x3F, 0x04}, // 't' (t)
    {0x7C, 0x40, 0x40, 0x20, 0x3C}, // 'u' (u)
    {0x1C, 0x20, 0x40, 0x20, 0x1C}, // 'v' (v)
    {0x3C, 0x40, 0x30, 0x40, 0x3C}, // 'w' (w)
    {0x44, 0x28, 0x10, 0x28, 0x44}, // 'x' (x)
    {0x0C, 0x50, 0x50, 0x50, 0x3C}, // 'y' (y)
    {0x44, 0x64, 0x54, 0x4C, 0x44}, // 'z' (z)
    {0x00, 0x41, 0x36, 0x08, 0x00}, // '{' (left brace)
    {0x00, 0x00, 0x7F, 0x00, 0x00}, // '|' (vertical bar)
    {0x00, 0x08, 0x36, 0x41, 0x00}, // '}' (right brace)
    {0x08, 0x10, 0x10, 0x08, 0x10}, // '~' (tilde)
};
